# 修改说明 - 自动化发布流程 (Binary Release)

## 1. 目标
建立一套自动化的构建与发布流程，将 `BilibiliCookieMgmt` 打包为独立的可执行文件 (EXE/Binary)，支持多平台 (Windows, Linux, macOS)，并发布到 GitHub Releases。

## 2. 参考项目
参考了 `BililiveRecorder` 的 GitHub Actions (`.github/workflows/release.yml`)，采用了类似的多平台构建策略和产物命名规范。

## 3. 实现方案

### 3.1 工作流文件
新建 `.github/workflows/binary-release.yml`。

### 3.2 构建流程
整个流程分为三个阶段：

1.  **前端构建 (Build WebUI)**
    *   环境: `ubuntu-latest`
    *   工具: Node.js 20, npm
    *   步骤:
        *   进入 `BilibiliCookieMgmt-web` 目录。
        *   执行 `npm install` 安装依赖。
        *   执行 `npm run build` 构建生产环境代码。
        *   将 `dist` 目录作为 artifact 上传 (`webui-dist`)。

2.  **后端构建 (Build Backend)**
    *   策略: 矩阵构建 (Matrix Build)
        *   `windows-latest` (x64)
        *   `ubuntu-latest` (x64)
        *   `macos-latest` (arm64 - M1/M2)
        *   `macos-13` (x64 - Intel)
    *   工具: Python 3.11, PyInstaller
    *   步骤:
        *   下载 `webui-dist` artifact 并解压到 `BilibiliCookieMgmt/static`。
        *   安装 Python 依赖 (`fastapi`, `uvicorn`, `pyyaml`, `httpx`, `aiofiles`, `pyinstaller`)。
        *   使用 PyInstaller 打包:
            *   配置 `--onefile` 生成单文件可执行程序。
            *   配置 `--name BilibiliCookieMgmt-CLI`。
            *   配置 `--add-data` 将 `static` 目录资源打包进程序 (Windows使用`;`, Unix使用`:`)。
            *   入口文件: `BilibiliCookieMgmt/main.py`。
        *   重命名产物以匹配目标平台与架构 (例如 `BilibiliCookieMgmt-CLI-win-x64.exe`)。
        *   压缩为 Zip 文件 (`BilibiliCookieMgmt-CLI-win-x64.zip`)。
        *   上传构建产物。

3.  **发布 (Release)**
    *   触发条件: `push` (branches: main, tags: v*), `workflow_dispatch`。
    *   步骤:
        *   下载所有构建产物。
        *   使用 `softprops/action-gh-release` 创建 GitHub Release。
        *   如果是 Tag 推送，发布为正式版；如果是分支推送，发布为 Pre-release (且更新 `latest` tag 或使用 nightly tag)。
        *   *注*: 根据用户需求 "按提交发布的，所以都不是正式版"，我们将配置为 Pre-release。

## 4. 产物命名规范 (参考)
*   `BilibiliCookieMgmt-CLI-win-x64.zip`
*   `BilibiliCookieMgmt-CLI-linux-x64.zip`
*   `BilibiliCookieMgmt-CLI-osx-arm64.zip`
*   `BilibiliCookieMgmt-CLI-osx-x64.zip`

## 5. 依赖变动
无代码依赖变动，仅增加构建依赖 `pyinstaller`。
需要确保 `BilibiliCookieMgmt/main.py` 在 PyInstaller 环境下能正确找到 `static` 资源 (已确认 `pathlib` 配合 PyInstaller `--add-data` 可兼容)。
